{% extends "base.html" %}

{% block title %}
    PopDarts Game
{% endblock %}

{% block content %}
    <link rel="stylesheet" href='../static/round.css' />
    <body>
        <div class="scores-tally box-frame">
            <div class="round-bar">
                <div class="team blue-team">
                    <div class="team-name" id="player1">{{ player_name[0] }}</div>
                    <div class="b-score" id="blue-point">{{ player_score[0] }}</div>
                </div>

                <div class="team green-team">
                    <div class="team-name" id="player2">{{ player_name[1] }}</div>
                    <div class="g-score" id="green-point">{{ player_score[1] }}</div>
                </div>
            </div>
            <div class="games-bar">
                <!-- <h3 class="title-tag games-bar">Rounds</h3>
                <br> -->
                <div class="rounds blue-team">
                    <div id="b_rounds">{{ player_rounds[0] }}</div>
                </div>
                <div class="rounds green-team">
                    <div id="g_rounds">{{ player_rounds[1] }}</div>
                </div>
            </div>
        </div>
        <div class="page-frame box-frame">
            <div class="video-frame">
                <video autoplay="true" id="live-video"></video>
                <div class="center-button">
                    <form id="next_round" action = "/procces" method="POST" onsubmit="captureImage(event)" enctype="multipart/form-data">
                        <input type="submit" value="Next Round" name="next">
                        <input type="hidden" name="player1" value="{{ player_name[0] }}">
                        <input type="hidden" name="player2" value="{{ player_name[1] }}">
                    </form>
                </div>
            </div>
            <div class="data-frame">
                <div class="averages">
                    <h3 class="heading">Status</h3>
                    <table class="match-average">
                        <thead>
                            <tr>
                                <th>Player</th>
                                <th>Match Average</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Name Test</td>
                                <td>Average</td>
                            </tr>
                            <tr>
                                <td>Name Test</td>
                                <td>Average</td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="score-average">
                        <thead>
                            <tr>
                                <th>Player</th>
                                <th>Score Average</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Name Test</td>
                                <td>Average</td>
                            </tr>
                            <tr>
                                <td>Name Test</td>
                                <td>Average</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="graph">
                    <h3 class="heading">Graphs</h3>
                    <div id="chart-container">
                        <canvas id="myChart" ></canvas>
                    </div>
                </div>
                <div class="buttons-tab">
                    <button name="graph1-button" title="NULL">NULL</button>
                    <button name="graph2-button" title="NULL">NULL</button>
                    <button name="graph3-button" title="NULL">NULL</button>
                    <button name="graph4-button" title="NULL">NULL</button>
                </div>
            </div>
        </div>
    </body>
    <script>
        let video = document.querySelector("#live-video")
        if (navigator.mediaDevices.getUserMedia){
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (stream){
                    video.srcObject = stream;
                })
                .catch (function (error){
                    console.log("AH Ay!")
                })
        } else{
            console.log("getUsermedia not supported!");
        }
        function captureImage(event) {
            event.preventDefault();

            // Create a canvas element
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // Draw the current video frame onto the canvas
            const context = canvas.getContext("2d");
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convert the canvas image to data URL
            const dataURL = canvas.toDataURL("image/jpeg");

            // Create a hidden input field to store the captured image data URL
            const imageInput = document.createElement("input");
            imageInput.type = "hidden";
            imageInput.name = "captured_image";
            imageInput.value = dataURL;

            // Append the hidden input field to the form
            const form = document.getElementById("next_round");
            form.appendChild(imageInput);

            // Submit the form
            form.submit();
        }
        $( function() {
            
            $('button[name="graph1-button"]').click(function() {
                if (onChart){
                    onChart.destroy();
                }

            });
            $('button[name="graph2-button"]').click(function() {
                if (onChart){
                    onChart.destroy();
                }

            });
            $('button[name="graph3-button"]').click(function() {
                if (onChart){
                    onChart.destroy();
                }

            });
            $('button[name="graph4-button"]').click(function() {
                if (onChart){
                    onChart.destroy();
                }
                
            });
        });
    </script>
{% endblock %}